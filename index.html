<!DOCTYPE html>
<html lang="tr" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BIQ-Alg 0CO2: Afet Bölgesi İçin İnovatif Hava Çözümü</title>
    
    <!-- Seçilen Palet: Energetic & Playful (#FF6B6B, #FFD166, #06D6A0, #118AB2, #073B4C) -->
    <!-- ONAYLAMA: SVG grafikleri kullanılmamıştır. NO Mermaid JS used. -->

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700;900&family=Montserrat:wght@700;800&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f8f9fa;
            color: #073B4C; 
        }
        .font-heading {
            font-family: 'Montserrat', sans-serif;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 350px;
            max-height: 450px;
        }
        .kpi-card-new {
            background-color: #ffffff;
            border-radius: 0.75rem;
            padding: 1.5rem;
            text-align: center;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .kpi-card-new:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }
        .nav-link.active {
            color: #118AB2;
            font-weight: 700;
        }
        .message-box {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #073B4C;
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s, transform 0.3s;
            transform: translate(-50%, 20px);
        }
        .message-box.show {
            opacity: 1;
            transform: translate(-50%, 0);
        }
        .region-select {
            appearance: none;
            background-image: url('data:image/svg+xml;charset=UTF-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>');
            background-repeat: no-repeat;
            background-position: right 0.5rem center;
            background-size: 1.5em 1.5em;
            padding-right: 2.5rem;
        }
    </style>
</head>

<body class="antialiased">

    <header class="bg-white/95 backdrop-blur-sm sticky top-0 z-50 shadow-md">
        <nav class="container mx-auto px-6 py-3 flex justify-between items-center">
            <a href="#hero" class="flex items-center space-x-3">
                <div class="h-12 w-12 flex-shrink-0 bg-[#06D6A0] rounded-full flex items-center justify-center shadow-md ring-2 ring-offset-2 ring-[#06D6A0]">
                   <span class="text-white text-2xl font-bold">🌿</span>
                </div>
                <span class="text-xl font-bold font-heading text-[#073B4C]">BIQ-Alg 0CO<sub class="text-base align-baseline">2</sub></span>
            </a>
            <div class="hidden md:flex items-center space-x-8">
                <a href="#problem-solution" class="nav-link text-gray-600 hover:text-[#118AB2] font-semibold transition-colors">Çözüm</a>
                <a href="#regional-data" class="nav-link text-gray-600 hover:text-[#118AB2] font-semibold transition-colors">Bölgesel Veri</a>
                <a href="#live-data" class="nav-link text-gray-600 hover:text-[#118AB2] font-semibold transition-colors">Canlı Veri</a>
                <a href="#vision" class="nav-link text-gray-600 hover:text-[#118AB2] font-semibold transition-colors">Vizyon</a>
                <a href="#future" class="nav-link text-gray-600 hover:text-[#118AB2] font-semibold transition-colors">Gelecek</a>
            </div>
        </nav>
    </header>

    <main>
        <section id="hero" class="py-20 md:py-32" style="background: linear-gradient(135deg, #118AB2 0%, #06D6A0 100%);">
            <div class="container mx-auto px-6 text-center text-white">
                <h1 class="text-4xl md:text-6xl font-bold font-heading mb-4 tracking-tight">Afet Sonrası Temiz Nefes: <br> BIQ-Alg 0CO2</h1>
                <p class="text-lg md:text-xl max-w-3xl mx-auto opacity-90">
                    Doğanın en güçlü savaşçıları olan mikroalgler ile afet bölgelerine anında hava kalitesi, sürdürülebilir enerji ve umut taşıyan mobil eğitim istasyonunu keşfedin.
                </p>
            </div>
        </section>

        <section id="problem-solution" class="py-16 md:py-24">
             <div class="container mx-auto px-6">
                <div class="text-center mb-12 md:mb-16">
                    <h2 class="text-3xl md:text-4xl font-bold font-heading text-[#073B4C]">Görünmez Tehlikeye Karşı Biyolojik Kalkan</h2>
                    <p class="mt-4 text-lg text-[#073B4C] max-w-3xl mx-auto">
                        Afetler, ardında sadece enkaz bırakmaz; aynı zamanda havayı kirleten tehlikeli partiküllerle doldurur. Geleneksel çözümler yetersiz kalırken, doğa bize çok daha güçlü bir alternatif sunuyor.
                    </p>
                </div>
                <div class="grid md:grid-cols-3 gap-8 items-center text-center">
                    <div class="bg-white p-8 rounded-xl shadow-lg">
                        <h3 class="font-heading text-2xl font-bold text-[#FF6B6B] mb-3">GELENEKSEL YÖNTEMLER</h3>
                        <p class="text-gray-600">Enerji yoğun, maliyetli ve sadece partikül filtreler. CO₂ yakalama veya O₂ üretme yetenekleri yoktur.</p>
                    </div>
                    <div class="p-8">
                         <div class="text-6xl md:text-8xl font-black text-[#118AB2] font-heading">50x</div>
                         <p class="font-bold text-xl mt-2 text-[#073B4C]">DAHA VERİMLİ</p>
                         <p class="text-gray-600 mt-1">Mikroalgler, karasal bitkilere göre 10 ila 50 kat daha verimli CO₂ yakalar.</p>
                    </div>
                    <div class="bg-white p-8 rounded-xl shadow-lg">
                        <h3 class="font-heading text-2xl font-bold text-[#06D6A0] mb-3">MİKROALG ÇÖZÜMÜ</h3>
                        <p class="text-gray-600">Havayı temizler, oksijen üretir ve döngüsel ekonomi için değerli biyokütle oluşturur.</p>
                    </div>
                </div>
            </div>
        </section>

        <section id="regional-data" class="py-16 md:py-24 bg-gray-100">
            <div class="container mx-auto px-6">
                <div class="text-center mb-12 md:mb-16">
                    <h2 class="text-3xl md:text-4xl font-bold font-heading text-[#073B4C]">Afet Bölgeleri Hava Kalitesi Simülasyonu</h2>
                    <p class="mt-4 text-lg text-[#073B4C] max-w-3xl mx-auto">
                        Projemiz, 6 Şubat depreminden etkilenen bölgelerdeki atmosfer verileri temel alınarak geliştirilmiştir. Aşağıdan bir bölge seçerek afet sonrası tipik hava koşullarını ve sistemimizin potansiyel etkisini görün.
                    </p>
                </div>
                <div class="flex justify-center mb-8">
                    <select id="region-select" class="region-select text-lg p-3 border-2 border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-[#118AB2]">
                        <option value="istanbul">İstanbul</option>
                        <option value="hatay">Hatay</option>
                        <option value="kahramanmaras">Kahramanmaraş</option>
                        <option value="gaziantep">Gaziantep</option>
                    </select>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6" id="regional-stats-container">
                    <!-- Bölgesel veri kartları buraya dinamik olarak gelecek -->
                </div>
            </div>
        </section>

        <section id="live-data" class="py-16 md:py-24">
            <div class="container mx-auto px-6">
                <div class="text-center mb-12 md:mb-16">
                    <h2 class="text-3xl md:text-4xl font-bold font-heading text-[#073B4C]">Canlı Veri İzleme Paneli</h2>
                    <p class="mt-4 text-lg text-[#073B4C] max-w-3xl mx-auto">
                        BIQ-Alg 0CO2 istasyonundan gelen gerçek zamanlı sensör verilerini buradan takip edin. Bu panel, sistemin anlık performansını ve çevre koşullarını gösterir.
                    </p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="kpi-card-new">
                        <h3 class="text-sm font-bold text-gray-500 uppercase tracking-wider">CO₂ Seviyesi</h3>
                        <p id="kpi-co2" class="text-4xl font-bold text-[#118AB2] mt-2">--- <span class="text-xl">ppm</span></p>
                    </div>
                    <div class="kpi-card-new">
                        <h3 class="text-sm font-bold text-gray-500 uppercase tracking-wider">Hava Kalitesi (MQ135)</h3>
                        <p id="kpi-mq135" class="text-4xl font-bold text-[#06D6A0] mt-2">--- <span class="text-xl">mV</span></p>
                    </div>
                    <div class="kpi-card-new">
                        <h3 class="text-sm font-bold text-gray-500 uppercase tracking-wider">Işık Şiddeti</h3>
                        <p id="kpi-light" class="text-4xl font-bold text-[#FFD166] mt-2">--- <span class="text-xl">lux</span></p>
                    </div>
                     <div class="kpi-card-new">
                        <h3 class="text-sm font-bold text-gray-500 uppercase tracking-wider">Sıcaklık & Nem</h3>
                        <p id="kpi-temp-humidity" class="text-4xl font-bold text-[#FF6B6B] mt-2">--°C / --%</p>
                    </div>
                </div>
                
                <div class="kpi-card-new mb-12">
                     <h3 class="text-sm font-bold text-gray-500 uppercase tracking-wider">Sistem Durumu Mesajı</h3>
                     <p id="status-message" class="text-lg text-[#073B4C] mt-2">Sensör verileri bekleniyor...</p>
                </div>
                
                <div class="text-center mb-8">
                    <h3 class="text-2xl font-bold font-heading text-[#073B4C] mb-4">Veri Grafikleri (Son 30 Okuma)</h3>
                    <button id="download-csv-btn" class="bg-[#118AB2] text-white font-bold py-2 px-4 rounded-lg hover:bg-[#0f7a9e] transition-colors shadow-md">
                        Verileri CSV Olarak İndir
                    </button>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="bg-white p-6 rounded-xl shadow-lg">
                        <div class="chart-container">
                            <canvas id="tempHumidityChart"></canvas>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-xl shadow-lg">
                        <div class="chart-container">
                            <canvas id="co2Chart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="vision" class="py-16 md:py-24 bg-gray-100">
            <div class="container mx-auto px-6">
                <div class="text-center mb-12 md:mb-16">
                    <h2 class="text-3xl md:text-4xl font-bold font-heading text-[#073B4C]">Geleceğin Şehirleri: Alg Kubbeleri</h2>
                    <p class="mt-4 text-lg text-[#073B4C] max-w-3xl mx-auto">
                        Bu teknoloji, sadece afet bölgeleri için değil, aynı zamanda geleceğin sürdürülebilir şehirleri için de bir vizyon sunuyor. Binaların kendi havasını temizlediği, enerji ürettiği ve doğayla bütünleştiği "Alg Kubbeleri"ni hayal edin.
                    </p>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div class="relative rounded-lg overflow-hidden shadow-lg">
                        <img src="https://placehold.co/600x400/06D6A0/FFFFFF?text=Alg+Mimarisi" alt="Fütüristik Alg Mimarisi" class="w-full h-full object-cover">
                        <div class="absolute bottom-0 left-0 bg-black/50 text-white p-4 w-full">
                            <h4 class="font-bold">Biyo-Entegre Yapılar</h4>
                            <p class="text-sm">Cepheleri mikroalglerle kaplı binalar, kentsel ısı adası etkisini azaltır ve havayı temizler.</p>
                        </div>
                    </div>
                    <div class="relative rounded-lg overflow-hidden shadow-lg">
                         <img src="https://placehold.co/600x400/118AB2/FFFFFF?text=Alg+Kubbesi" alt="Şehir İçinde Bir Alg Kubbesi" class="w-full h-full object-cover">
                         <div class="absolute bottom-0 left-0 bg-black/50 text-white p-4 w-full">
                            <h4 class="font-bold">Yaşayan Alanlar</h4>
                            <p class="text-sm">Parklar ve ortak alanlardaki alg kubbeleri, hem estetik bir değer katar hem de halk için temiz hava vahaları oluşturur.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="future" class="py-16 md:py-24">
             <div class="container mx-auto px-6">
                <div class="text-center mb-12 md:mb-16">
                    <h2 class="text-3xl md:text-4xl font-bold font-heading text-[#073B4C]">Gelecek Adımları</h2>
                     <p class="mt-4 text-lg text-[#073B4C] max-w-3xl mx-auto">
                        Bu proje, daha yeşil ve sağlıklı bir gelecek için sadece bir başlangıç.
                    </p>
                </div>
                <div class="grid md:grid-cols-3 gap-8 text-center">
                    <div class="bg-white p-8 rounded-xl shadow-lg hover:shadow-xl transition-shadow">
                        <div class="text-5xl mb-4">⚙️</div>
                        <h3 class="text-xl font-bold font-heading mb-2 text-[#118AB2]">Teknoloji Geliştirme</h3>
                        <p class="text-gray-600">Daha verimli ve dayanıklı alg türleri araştırmak, FBR tasarımlarını optimize etmek ve maliyetleri düşürmek.</p>
                    </div>
                    <div class="bg-white p-8 rounded-xl shadow-lg hover:shadow-xl transition-shadow">
                        <div class="text-5xl mb-4">🌍</div>
                        <h3 class="text-xl font-bold font-heading mb-2 text-[#06D6A0]">Yaygınlaştırma</h3>
                        <p class="text-gray-600">Mobil üniteleri farklı afet senaryolarında test ederek kentsel alanlara ve okullara entegre etmek.</p>
                    </div>
                    <div class="bg-white p-8 rounded-xl shadow-lg hover:shadow-xl transition-shadow">
                        <div class="text-5xl mb-4">🤝</div>
                        <h3 class="text-xl font-bold font-heading mb-2 text-[#FFD166]">Ekonomik Model</h3>
                        <p class="text-gray-600">Biyokütle yan ürünleri için pazar oluşturmak ve karbon kredisi gibi finansman modelleri geliştirmek.</p>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="bg-[#073B4C] text-white py-8">
        <div class="container mx-auto px-6 text-center">
            <p>&copy; 2025 BIQ-Alg 0CO2 Projesi. Tüm Hakları Saklıdır.</p>
            <p class="text-sm opacity-70 mt-2" id="location-info">Konum bilgisi alınıyor...</p>
        </div>
    </footer>
    
    <div id="message-box" class="message-box"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        document.addEventListener('DOMContentLoaded', async function () {
            
            const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
            const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
            let db, auth, userId;
            let sensorDataHistory = [];

            function showMessage(message, duration = 3000) {
                const messageBox = document.getElementById('message-box');
                messageBox.textContent = message;
                messageBox.classList.add('show');
                setTimeout(() => {
                    messageBox.classList.remove('show');
                }, duration);
            }

            try {
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
            } catch(e) {
                console.error("Firebase başlatma hatası:", e);
                const statusMessage = document.getElementById('status-message');
                if(statusMessage) statusMessage.textContent = 'Hata: Firebase başlatılamadı.';
                return;
            }
            
            onAuthStateChanged(auth, async (user) => {
                if (user) {
                    userId = user.uid;
                    console.log("Kullanıcı oturum açtı:", userId);
                    startRealtimeListeners();
                } else {
                     try {
                        const token = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
                        if (token) {
                            await signInWithCustomToken(auth, token);
                        } else {
                            await signInAnonymously(auth);
                        }
                    } catch (error) {
                        console.error("Kimlik doğrulama hatası:", error);
                        showMessage("Canlı verilere bağlanılamadı.");
                    }
                }
            });

            // Canlı Veri Grafikleri
            const createChart = (ctx, datasets) => new Chart(ctx, { type: 'line', data: { labels: [], datasets: datasets }, options: { responsive: true, maintainAspectRatio: false, scales: { x: { type: 'time', time: { unit: 'second', displayFormats: { second: 'HH:mm:ss' } }, ticks: { source: 'auto', maxRotation: 0, autoSkip: true, maxTicksLimit: 7 } }, y: { beginAtZero: false } }, plugins: { legend: { display: true } } } });
            
            const tempHumidityCtx = document.getElementById('tempHumidityChart').getContext('2d');
            const co2Ctx = document.getElementById('co2Chart').getContext('2d');
            const tempHumidityChart = createChart(tempHumidityCtx, [
                { label: 'Sıcaklık (°C)', data: [], borderColor: '#FF6B6B', backgroundColor: 'rgba(255, 107, 107, 0.1)', tension: 0.2, fill: true },
                { label: 'Nem (%)', data: [], borderColor: '#118AB2', backgroundColor: 'rgba(17, 138, 178, 0.1)', tension: 0.2, fill: true }
            ]);
            const co2Chart = createChart(co2Ctx, [{ label: 'CO₂ (ppm)', data: [], borderColor: '#06D6A0', backgroundColor: 'rgba(6, 214, 160, 0.1)', tension: 0.2, fill: true }]);

            function updateChartData(chart, point) {
                const maxDataPoints = 30;
                if (chart.data.labels.length >= maxDataPoints) {
                    chart.data.labels.shift();
                    chart.data.datasets.forEach(dataset => dataset.data.shift());
                }
                chart.data.labels.push(point.x);
                point.y.forEach((yValue, index) => chart.data.datasets[index].data.push(yValue));
                chart.update('quiet');
            }

            function startRealtimeListeners() {
                const liveDataRef = doc(db, `artifacts/${appId}/public/data/sensors/current_data`);
                onSnapshot(liveDataRef, (docSnap) => {
                    if (docSnap.exists()) {
                        const data = docSnap.data();
                        const timestamp = data.timestamp?.toDate() || new Date();
                        
                        sensorDataHistory.push(data);
                        if(sensorDataHistory.length > 30) sensorDataHistory.shift();
                        
                        document.getElementById('kpi-co2').innerHTML = `${data.co2 || '---'} <span class="text-xl">ppm</span>`;
                        document.getElementById('kpi-mq135').innerHTML = `${data.mq135_value || '---'} <span class="text-xl">mV</span>`;
                        document.getElementById('kpi-light').innerHTML = `${data.light_value || '---'} <span class="text-xl">lux</span>`;
                        document.getElementById('kpi-temp-humidity').innerHTML = `${data.temperature?.toFixed(1) || '--'}°C / ${data.humidity?.toFixed(1) || '--'}%`;
                        
                        let statusMsg = "Sistem durumu iyi. Mikroalgler aktif olarak çalışıyor.";
                        if (data.co2 > 800) statusMsg = 'Yüksek CO₂ seviyesi tespit edildi!';
                        else if (data.temperature > 28) statusMsg = 'Sistem sıcaklığı yüksek!';
                        document.getElementById('status-message').textContent = statusMsg;

                        updateChartData(tempHumidityChart, { x: timestamp, y: [data.temperature, data.humidity] });
                        updateChartData(co2Chart, { x: timestamp, y: [data.co2] });

                    } else {
                        document.getElementById('status-message').textContent = "Canlı veri kaynağı bulunamadı.";
                    }
                }, (error) => {
                    console.error("Firebase dinleme hatası:", error);
                    document.getElementById('status-message').textContent = "Canlı veri akışında bir sorun oluştu.";
                });
            }

            // Bölgesel Veri Yönetimi
            const regionalData = {
                istanbul: { co2: '700-1000 ppm', particles: 'Orta', temp: '18-28°C' },
                hatay: { co2: '1100-1500 ppm', particles: 'Yüksek', temp: '25-35°C' },
                kahramanmaras: { co2: '900-1200 ppm', particles: 'Yüksek', temp: '20-30°C' },
                gaziantep: { co2: '800-1100 ppm', particles: 'Orta-Yüksek', temp: '22-32°C' }
            };

            const regionSelect = document.getElementById('region-select');
            const regionalStatsContainer = document.getElementById('regional-stats-container');
            
            function updateRegionalStats(region) {
                const data = regionalData[region];
                regionalStatsContainer.innerHTML = `
                    <div class="kpi-card-new">
                        <h4 class="text-sm font-bold text-gray-500 uppercase tracking-wider">Tahmini CO₂</h4>
                        <p class="text-3xl font-bold text-[#118AB2] mt-2">${data.co2}</p>
                    </div>
                    <div class="kpi-card-new">
                        <h4 class="text-sm font-bold text-gray-500 uppercase tracking-wider">Parçacık Yoğunluğu</h4>
                        <p class="text-3xl font-bold text-[#06D6A0] mt-2">${data.particles}</p>
                    </div>
                    <div class="kpi-card-new">
                        <h4 class="text-sm font-bold text-gray-500 uppercase tracking-wider">Ortalama Sıcaklık</h4>
                        <p class="text-3xl font-bold text-[#FF6B6B] mt-2">${data.temp}</p>
                    </div>
                `;
            }
            
            regionSelect.addEventListener('change', (e) => updateRegionalStats(e.target.value));
            updateRegionalStats('istanbul');

            // Konum Bilgisi Alma
            const locationInfo = document.getElementById('location-info');
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        locationInfo.textContent = `Konumunuz: Enlem ${position.coords.latitude.toFixed(2)}, Boylam ${position.coords.longitude.toFixed(2)}`;
                    },
                    () => {
                        locationInfo.textContent = 'Konum bilgisi paylaşılamadı.';
                    }
                );
            } else {
                locationInfo.textContent = 'Tarayıcınız konum servisini desteklemiyor.';
            }

            // Navigasyon ve CSV indirme
            const navLinks = document.querySelectorAll('.nav-link');
            const sections = document.querySelectorAll('main section');
            window.addEventListener('scroll', () => {
                let current = 'hero';
                sections.forEach(section => {
                    if (window.pageYOffset >= section.offsetTop - 75) current = section.id;
                });
                navLinks.forEach(link => link.classList.toggle('active', link.href.includes(current)));
            });

            document.getElementById('download-csv-btn').addEventListener('click', () => {
                if (sensorDataHistory.length === 0) {
                    showMessage("Dışa aktarılacak veri bulunamadı.");
                    return;
                }
                const headers = ["timestamp", "co2", "mq135_value", "light_value", "temperature", "humidity"];
                let csvContent = "data:text/csv;charset=utf-8," + headers.join(",") + "\\n";
                sensorDataHistory.forEach(row => {
                    const timestamp = row.timestamp?.toDate ? row.timestamp.toDate().toISOString() : new Date().toISOString();
                    const values = [timestamp, row.co2, row.mq135_value, row.light_value, row.temperature, row.humidity];
                    csvContent += values.join(",") + "\\n";
                });
                
                const encodedUri = encodeURI(csvContent);
                const link = document.createElement("a");
                link.setAttribute("href", encodedUri);
                link.setAttribute("download", "biq_alg_sensor_verileri.csv");
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                showMessage("Veriler CSV olarak indirildi!");
            });
        });
    </script>
</body>
</html>
